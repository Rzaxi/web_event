<!DOCTYPE html>
<html>
<head>
    <title>Generate New Verification Token</title>
</head>
<body>
    <h2>Fix Verification Issues</h2>
    
    <div style="margin-bottom: 30px;">
        <h3>1. Generate New Token</h3>
        <form id="tokenForm">
            <input type="email" id="email" placeholder="Masukkan email Anda" required value="johndae@example.com">
            <button type="submit">Generate Token</button>
        </form>
        <div id="tokenResult"></div>
    </div>

    <div style="margin-bottom: 30px;">
        <h3>2. Force Verify User (Fix Broken Verification)</h3>
        <form id="forceVerifyForm">
            <input type="email" id="forceEmail" placeholder="Email yang ingin diverifikasi" required>
            <button type="submit">Force Verify</button>
        </form>
        <div id="forceResult"></div>
    </div>

    <script>
        document.getElementById('tokenForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            
            try {
                const response = await fetch('http://localhost:3000/api/auth/generate-token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('tokenResult').innerHTML = `
                        <h3>Success!</h3>
                        <p>Token: ${data.token}</p>
                        <p><a href="http://localhost:3000/api/auth/verify-email/${data.token}" target="_blank">Click to verify</a></p>
                    `;
                } else {
                    document.getElementById('tokenResult').innerHTML = `<p style="color: red;">Error: ${data.message}</p>`;
                }
            } catch (error) {
                document.getElementById('tokenResult').innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        });

        // Force verify form handler
        document.getElementById('forceVerifyForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('forceEmail').value;
            
            try {
                const response = await fetch('http://localhost:3000/api/auth/force-verify', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('forceResult').innerHTML = `
                        <h3 style="color: green;">Success!</h3>
                        <p>${data.message}</p>
                        <p>User sekarang sudah verified dan bisa login!</p>
                    `;
                } else {
                    document.getElementById('forceResult').innerHTML = `<p style="color: red;">Error: ${data.message}</p>`;
                }
            } catch (error) {
                document.getElementById('forceResult').innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        });
    </script>
</body>
</html>
